# 宏
## 编译预处理指令
- #开头的是编译预处理指令
- 它们不是C语言的成分，但是C语言程序离不开它们
- #define用来定义一个宏
  - #define PI 3.14159
  - #define FORMAT "%f\n"
  ```
  #include<stdio.h>
  //const double PI = 3.14159;
  #define PI 3.14159
  #define FORMAT "%f\n"

  int main(int argc, char const *argv[])
  {
    printf(FORMAT, 2*PI*3.0);
    //printf("%f\n", 2*3.14159*3.0);
    return 0;
  }
  ```
## define
- #define <名字><值>
- 注意没有结尾的分号，因为不是C的语句
- 名字必须是一个单词，值可以是各种东西
- 在C语言的编译器开始编译之前，编译预处理程序(cpp)会把程序中的名字换成值
  - 完全的文本替换
- gcc --save-temps
## 宏
- 如果一个宏的值中有其它宏的名字，也是会被替换的
- 如果一个宏的值超过一行，最后一行之前的行末需要加\
- 宏的值后面出现的注释不会被当作宏的值的一部分
### 没有值的宏
- #define _DEBUG
- 这类宏是用于条件编译的，后面有其他的编译预处理指令来检查这个宏是否已经被定义过了
## 带参数的宏
- define cube(x)((x)\*(x)*(x))
- 宏可以带参数
### 带参数的宏的原则
- 一切都要有括号
  - 整个值要括号
  - 参数出现的每个地方都要括号
- #define RADTODEG(x)((x)*57.29578)
### 带参数的宏
- 可以带多个参数
  - #define MIN(a,b) ((a)>(b)?(b):(a))
- 也可以组合（嵌套）使用其他宏

# 大程序结构
## 多个.C文件
- main()里的代码太长了适合分成几个函数
- 一个源代码文件太长了适合分成几个文件
- 两个独立的源代码文件不能编译形成可执行的程序
## 项目
- 在Dev C++中新建一个项目，然后把几个源代码文件加入进去
- 对于项目，Dev C++的编译会把一个项目中的所有的源代码文件都编译后，链接起来
- 有的IDE有分开的编译和构建两个按钮，前者是对单个源代码文件编译，后者是对整个项目做链接
## 编译单元
- 一个.c文件是一个编译单元
- 编译器每次编译只处理一个编译单元

## 头文件
把函数原型放到一个头文件（以.h结尾）中，在需要调用这个函数的源代码文件（.c文件）中#include这个头文件，就能让编译器在编译的时候知道函数的原型
### #include
- #include是一个编译预处理指令，和宏一样，在编译之前就处理了
- 它把那个文件的全部文本内容原封不动地插入到它所在的地方
- 所以也不是一定要在.c文件的最前面#include
### #include用""还是<>?
- #include有两种形式来指出要插入的文件
  - ""要求编译器首先在当前目录（.c文件所在的目录）寻找这个文件，如果没有，到编译器指定的目录去找
  - <>让编译器只在指定的目录去找
- 编译器知道自己的标准库的头文件在哪里
  - linux系统
  ```
  cd /usr/include/
  ls -l stdio.h
  ```
- 环境变量和编译器命令行参数也可以指定寻找头文件的目录
### #include的误区
- #include不是用来引入库的
- stdio.h里只有printf的原型，printf的代码在另外的地方，某个.lib(windows)或.a(Unix)中
- 现在的C语言编译器默认会引入所有的标准库
- #include<stdio.h>只是为了让编译器知道printf函数的原型，保证你调用时给出的函数值是正确的类型
### 头文件
- 在使用和定义这个函数的地方都应该#include这个头文件
- 一般的做法就是任何.c都有对应的同名的.h，把所有对外公开的函数的原型和全局变量的声明都放进去
### 不对外公开的函数
- 在函数前面加上static就使得它成为只能在所在的编译单元中被使用的函数
- 在全局变量前面加上static就使得它成为只能在所在的编译单元中被使用的全局变量

## 声明
- int i;是变量的定义
- extern int i; 是变量的声明
### 头文件
- 只有声明可以被放在头文件中
  - 是规则不是法律
- 否则会造成一个项目中多个编译单元里有重名的实体
  - *某些编译器允许几个编译单元中存在同名的函数，或者用weak修饰符来强调这种存在
### 重复声明
- 同一个编译单元里，同名的结构不能被重复声明
- 如果你的头文件里有结构的声明，很难这个头文件不会在一个编译单元里被#inlcude多次
- 多以需要“标准头文件结构”